import java.awt.Color;
import java.awt.EventQueue;

import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JToggleButton;

import java.awt.GridLayout;
import javax.swing.JComboBox;
import javax.swing.BorderFactory;
import javax.swing.DefaultComboBoxModel;
import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashSet;
import java.util.LinkedHashMap;
import java.util.Set;
import java.awt.event.ActionEvent;
import javax.swing.JLabel;
import javax.swing.JOptionPane;

import java.awt.Font;
import javax.swing.JButton;
import javax.swing.SwingConstants;
import javax.swing.UIManager;

public class GridMaker {

	private JFrame frame;
	private JButton b;
	
	
	public boolean startButton;
	public boolean goalButton;
	public boolean blockButton;
	
	public static int chosenX;
	public static int chosenY;
	public static Node start;
	public static Node end;
	public static String searchType = "Depth First Search";
	
	public static ArrayList<JButton> gridButton ; //list of Buttons
	public static ArrayList<Coordinate> gridCoord;//= new ArrayList<Coordinate>(); //list of Coordinates
	public static LinkedHashMap<String,Coordinate> linkage;//= new LinkedHashMap<String, Coordinate>(); //links between button Name(string coordinate) and coordinate
	private static Set<Node> blockSet;//= new HashSet<>();
	private static ArrayList<Node> block;//= new ArrayList<Node>();
	public static ArrayList<Node> obstacles;//= new ArrayList<Node>();
	
	
	//Boolean flags for which search is selected by the user
	public boolean isDFS = false;
	public boolean isBFS = false;
	public boolean isAstar = false;
	

	/**
	 * Launch the application.
	 */
	public static void openUI()
	{
		EventQueue.invokeLater(new Runnable() 
		{
			public void run() 
			{
				try 
				{
					GridMaker window = new GridMaker();
					window.frame.setVisible(true);
				} 
				catch (Exception e) 
				{
					e.printStackTrace();
				}
			}
		});
	}

	/**
	 * Create the application.
	 */
	public GridMaker() {
		initialize();
		gridCoord = new ArrayList<Coordinate>();
		linkage = new LinkedHashMap<String, Coordinate>();
		blockSet= new HashSet<>();
		block= new ArrayList<Node>();
		obstacles= new ArrayList<Node>();
	}

	/**
	 * Initialize the contents of the frame.
	 */
	private void initialize() {
		frame = new JFrame();
		frame.getContentPane().setEnabled(false);
		frame.getContentPane().setBackground(Color.DARK_GRAY);
		frame.setBounds(100, 100, 1028, 628);
		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		frame.getContentPane().setLayout(null);
		frame.setLocationRelativeTo(null);
		
		UIManager.put("ScrollBar.thumbHighlight", Color.LIGHT_GRAY);         
		UIManager.put("ScrollBar.thumbDarkShadow", Color.LIGHT_GRAY);
		UIManager.put("ScrollBar.highlight", Color.LIGHT_GRAY);
		UIManager.put("ScrollBar.trackHighlight", Color.LIGHT_GRAY);
		UIManager.put("ScrollBar.trackHighlight", Color.LIGHT_GRAY);
		UIManager.put("ComboBox.selectionBackground", Color.LIGHT_GRAY);
		
		
//-------------------------------------Combo Box for selecting size of board-------------------
		
		JLabel lblSizeOfBoard = new JLabel("Size of Board: ");
		lblSizeOfBoard.setForeground(Color.BLACK);
		lblSizeOfBoard.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 16));
		lblSizeOfBoard.setBounds(22, 62, 111, 22);
		frame.getContentPane().add(lblSizeOfBoard);
		
		//set items in column drop down table
		Integer[] m = {5, 6, 7, 8, 9, 10}; 
		
		//set items in row drop down table
		Integer[] n = {5, 6, 7, 8, 9, 10}; 
		chosenX = chosenX+5;
		chosenY = chosenY+5;
		
		
//----------------------------------------Create the board according to user's input---------------		
		
		//Create a JPanel for the grid board
		JPanel mainPanel = new JPanel();
		mainPanel.setBounds(413, 41, 500, 500);
		
		JPanel searchPanel = new JPanel();
		searchPanel.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
		searchPanel.setBackground(Color.LIGHT_GRAY);
		searchPanel.setBounds(10, 414, 231, 143);
		frame.getContentPane().add(searchPanel);
		searchPanel.setLayout(null);
		
		
//--------------------------------------------------ComboBox for choosing search methods---------------------------		
		
		JComboBox<String> searchTypeComboBox = new JComboBox<String>();
		searchTypeComboBox.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 11));
		searchTypeComboBox.setBackground(new Color(210, 105, 30));
		searchTypeComboBox.setForeground(Color.DARK_GRAY);
		searchTypeComboBox.setBounds(10, 44, 201, 34);
		searchPanel.add(searchTypeComboBox);
		searchTypeComboBox.setModel(new DefaultComboBoxModel(new String[] {"Depth First Search", "Breadth First Search", "A* Search"}));
		
		

//-----------------------------------------Start to search-----------------------------		
		
		JLabel searchTypeLbl = new JLabel("Search type");
		searchTypeLbl.setForeground(Color.DARK_GRAY);
		searchTypeLbl.setBounds(10, 11, 86, 22);
		searchPanel.add(searchTypeLbl);
		searchTypeLbl.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 16));
		
		JButton startSearchBtn = new JButton("Start Search");
		startSearchBtn.setToolTipText("Begin the Search");
		startSearchBtn.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 11));
		startSearchBtn.setBounds(10, 98, 201, 34);
		searchPanel.add(startSearchBtn);
	
		ChangeButtonColour(startSearchBtn);
		
		JPanel gridMakerPanel = new JPanel();
		gridMakerPanel.setBackground(Color.LIGHT_GRAY);
		gridMakerPanel.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
		gridMakerPanel.setBounds(10, 48, 279, 261);
		frame.getContentPane().add(gridMakerPanel);
		gridMakerPanel.setLayout(null);
		
		JToggleButton setBlocksBtn = new JToggleButton("Set Blocks");
		setBlocksBtn.setToolTipText("Select blocked nodes");
		setBlocksBtn.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 11));
		setBlocksBtn.setBackground(Color.DARK_GRAY);
		setBlocksBtn.setForeground(new Color(210, 105, 30));
		setBlocksBtn.setBounds(10, 227, 136, 23);
		gridMakerPanel.add(setBlocksBtn);
		
		setBlocksBtn.addMouseListener(new MouseAdapter()
		{
			public void mouseEntered(MouseEvent evt)
            {
            	setBlocksBtn.setBorder(BorderFactory.createLineBorder(Color.BLACK));
            	setBlocksBtn.setBackground(new Color(210, 105, 30));
            	setBlocksBtn.setForeground(Color.DARK_GRAY);
            }
            public void mouseExited(MouseEvent evt)
            {
            	setBlocksBtn.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
            	setBlocksBtn.setBackground(Color.DARK_GRAY);
            	setBlocksBtn.setForeground(new Color(210, 105, 30));
            }
            public void mousePressed(MouseEvent evt)
            {
            	setBlocksBtn.setBorder(BorderFactory.createLineBorder(Color.DARK_GRAY));
            }
            public void mouseReleased(MouseEvent evt)
            {
            	setBlocksBtn.setBorder(BorderFactory.createLineBorder(Color.DARK_GRAY));
            }
		});
		
				
		//---------------------------------create buttons------------------------
				
		JButton selectGoalNodeBtn = new JButton("Select Goal Node");
		selectGoalNodeBtn.setToolTipText("Select the goal of the search");
		selectGoalNodeBtn.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 11));
		selectGoalNodeBtn.setBounds(10, 191, 136, 25);
		gridMakerPanel.add(selectGoalNodeBtn);
	
		ChangeButtonColour(selectGoalNodeBtn);
		
		JButton selectStartBtn = new JButton("Select Start Node");
		selectStartBtn.setToolTipText("Select start node of the search");
		selectStartBtn.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 11));
		selectStartBtn.setBounds(10, 155, 136, 25);
		gridMakerPanel.add(selectStartBtn);
	
		ChangeButtonColour(selectStartBtn);
		
		JComboBox gridYComboBox = new JComboBox(n);
		gridYComboBox.setToolTipText("Y coordinate");
		gridYComboBox.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 11));
		gridYComboBox.setBackground(new Color(210, 105, 30));
		gridYComboBox.setForeground(Color.DARK_GRAY);
		gridYComboBox.setBounds(223, 22, 44, 22);
		gridMakerPanel.add(gridYComboBox);
				
		//label indicating times
		JLabel lblX = new JLabel("X");
		lblX.setHorizontalAlignment(SwingConstants.CENTER);
		lblX.setBounds(197, 23, 18, 16);
		gridMakerPanel.add(lblX);
		lblX.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 16));
		
		JComboBox gridXComboBx = new JComboBox(m);
		gridXComboBx.setToolTipText("X coordinate");
		gridXComboBx.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 11));
		gridXComboBx.setBackground(new Color(210, 105, 30));
		gridXComboBx.setForeground(Color.DARK_GRAY);
		gridXComboBx.setBounds(140, 22, 44, 22);
		gridMakerPanel.add(gridXComboBx);
				
		//Create a create grid button to paint the grid buttons onto the JPanel once pressed
		JButton createGridBtn = new JButton("Create Grid");
		createGridBtn.setToolTipText("Generate the grid");
		createGridBtn.setFont(new Font("Yu Gothic UI Semibold", Font.PLAIN, 11));
		createGridBtn.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
		createGridBtn.setBounds(10, 48, 111, 25);
		createGridBtn.setRolloverEnabled(true);
		createGridBtn.setFocusPainted(false);
		gridMakerPanel.add(createGridBtn);
		
		JLabel clickAgainLabel = new JLabel("<html>click again to <br>\r\ndeselect blocks<html>");
		clickAgainLabel.setBounds(158, 227, 115, 30);
		gridMakerPanel.add(clickAgainLabel);
		clickAgainLabel.setVisible(false);
		
		
		ChangeButtonColour(createGridBtn);
		
		createGridBtn.addActionListener(new ActionListener() 
		{
			public void actionPerformed(ActionEvent arg0) 
			{
				mainPanel.removeAll();
				
				
					gridCoord.clear();		
					gridButton = new ArrayList<JButton>();
				
				//set the grid layout of board + assign coordinates to them
				mainPanel.setLayout(new GridLayout(chosenY, chosenX));
								
				for(int m=0; m < chosenY ; m++)
				{
					for(int n=0; n < chosenX; n++)
					{
						b=new JButton();
						b.setBackground(Color.DARK_GRAY);
						mainPanel.add(b);
						b.setActionCommand("("+ n + "," + m + ")"); //assign string coordinate to the button
						gridButton.add(b);
						Coordinate element = new Coordinate(n,m); //create list of Coordinates according to size of board
						gridCoord.add(element);
					}
				}
						

				//-------------------------------------------------assigning action listener to the grid----------------------

				for(int i=0; i<gridButton.size();i++)
				{
					gridButton.get(i).addActionListener(new ActionListener()
							{
								public void actionPerformed(ActionEvent event)
								{
									int index = gridButton.indexOf(event.getSource());
									if(index>=0)
									{
										if(startButton==true)
										{
											//make sure it hasn't been chosen before
											if(start!=null)
											{
												for(int i=0; i<gridButton.size();i++)
												{
													if(gridButton.get(i).getBackground()==Color.green)
													{
														gridButton.get(i).setBackground(Color.DARK_GRAY);
													}
												}
												start=null; //set the start node back to null	
											}			
											gridButton.get(index).setBackground(Color.green); //set button to red
														
											Coordinate a= linkage.get(gridButton.get(index).getActionCommand());//retrieve the grid coordinate
											System.out.println("startNode selected: ");
											System.out.println("The coordinate is: "+ a);
															
											start=new Node(a, true);//create the start Node.
														
											startButton=false;
											selectGoalNodeBtn.setEnabled(true);
											setBlocksBtn.setEnabled(true);
										}
										else if(goalButton==true)
										{
											//make sure it hasn't been chosen before
											if(end!=null)
											{
												for(int i=0; i<gridButton.size();i++)
												{
													if(gridButton.get(i).getBackground()==Color.red)
													gridButton.get(i).setBackground(Color.DARK_GRAY);
												}
												end=null; //set the end node back to null
											}
															
											gridButton.get(index).setBackground(Color.red);//set button to green
															
											Coordinate b= linkage.get(gridButton.get(index).getActionCommand());//retrieve the grid coordinate
											System.out.println("goalNode selected... ");
											System.out.println("The coordinate is: "+ b);
															
											end=new Node(b, true);//set the goal node
													
											goalButton=false;
											selectStartBtn.setEnabled(true);
											setBlocksBtn.setEnabled(true);
										}
										else if(blockButton==true)
										{
											//if selected, allow change of board
											if(setBlocksBtn.isSelected())
											{
												
												if(gridButton.get(index).getBackground()==Color.LIGHT_GRAY)
												{
													gridButton.get(index).setBackground(Color.DARK_GRAY);
												}
												else
												{
													gridButton.get(index).setBackground(Color.LIGHT_GRAY);
												}			
												Coordinate c = linkage.get(gridButton.get(index).getActionCommand());//retrieve the grid coordinate
												Node n= new Node(c, false);
												
												block.add(n);
												
												System.out.println("I selected a block");
												System.out.println(gridButton.get(index).getActionCommand());
												System.out.println("The block array currently has: "+ block);
											}
											else
											{
												
												selectStartBtn.setEnabled(true);
												selectGoalNodeBtn.setEnabled(true);
												blockButton=false;
																								
											}
											
													
										}
										else
										{
											System.out.println("What do you want to put here?");
										}
									}
								}
							});
						}

						//(means of verifying) try to print out to see if i'm correct
						System.out.println("Size of Coord arrayLiat: "+ gridCoord.size());
						System.out.println("Size of String Coord ArrayList: "+ gridButton.size());
						
						System.out.println("Coordinates: "+ gridCoord);
						System.out.print("String Coordinates: ");
						for(int i=0; i<gridButton.size();i++)
						{
							System.out.print(gridButton.get(i).getActionCommand());
						}
						System.out.println();
						
						//put the two arrays into a linked hash map for easier calling in the furure
						for(int i=0; i<gridCoord.size();i++)
						{
								linkage.put(gridButton.get(i).getActionCommand(), gridCoord.get(i));
						}
						System.out.println(linkage);

						
						//repaint the JPanel
						frame.getContentPane().add(mainPanel);
						mainPanel.revalidate();
						mainPanel.repaint();
					}
				});
				gridXComboBx.addItemListener(
						new ItemListener()
						{
							public void itemStateChanged(ItemEvent event)
							{
								if(event.getStateChange()==ItemEvent.SELECTED)
								{
									chosenX = m[gridXComboBx.getSelectedIndex()];
									System.out.println("chosenX is: "+ chosenX);
									
									
								}
							}
						}
				);
				gridYComboBox.addItemListener(
						new ItemListener()
						{
							public void itemStateChanged(ItemEvent event)
							{
								if(event.getStateChange()==ItemEvent.SELECTED)
								{
									chosenY = n[gridYComboBox.getSelectedIndex()];
									System.out.println("chosenY: "+chosenY);
									
								}
								
							}
						}
				);
			
//----------------------------------user select start node-----------------------		
				
			selectStartBtn.addActionListener(new ActionListener() 
			{
				public void actionPerformed(ActionEvent arg0) 
				{
					startButton = true;
					System.out.println("start Button is chosen");
					//set an icon ---> make sure they choose the grid first before they can choose other selection button
						
					selectGoalNodeBtn.setEnabled(false);
					setBlocksBtn.setEnabled(false);	
				}
			});
			selectGoalNodeBtn.addActionListener(new ActionListener()
			{
				public void actionPerformed(ActionEvent e)
				{
					goalButton = true;
					System.out.println("Goal Button is chosen");
					selectStartBtn.setEnabled(false);
					setBlocksBtn.setEnabled(false);
				}
			});
			setBlocksBtn.addActionListener(new ActionListener()
			{
				public void actionPerformed(ActionEvent e)
				{
					if(setBlocksBtn.isSelected())
					{
						clickAgainLabel.setVisible(true);
						blockButton=true;
						System.out.println("blockButton is chosen");
						selectStartBtn.setEnabled(false);
						selectGoalNodeBtn.setEnabled(false);
					}
					else
					{
						clickAgainLabel.setVisible(false);
						selectStartBtn.setEnabled(true);
						selectGoalNodeBtn.setEnabled(true);
					}

				}
			});
		startSearchBtn.addActionListener(new ActionListener() {
		public void actionPerformed(ActionEvent arg0) 
		{
			try
			{
				//pass the data to generate the graph for the search 
				GraphGenerator graphGen = new GraphGenerator();
				
				//blockSet is used to keep track of each node chosen
				blockSet.addAll(block);
				System.out.println("Block array: "+ block);
				System.out.println("Block Set: "+ blockSet);
				
				//count the number of that elements in blocks
				//if odd-> keep -> put to final list for 
				//if even-> do nothing			
				for(Node key : blockSet)
				{
					int x = Collections.frequency(block, key);
					if(x%2 == 1)
					{
						obstacles.add(key);
					}
				}
				System.out.println("obstacles array: "+obstacles);
				
				GraphGenerator g = new GraphGenerator();
				LinkedHashMap<Integer, Node> graph= g.genGraph(chosenX, chosenY, obstacles);
				
				//LinkedHashMap<Integer, Node> graph = graphGen.genGraph(chosenX, chosenY, obstacles);
				//open up the visualisation UI pass the search type graph start and end nodes
				VisualisationUI.openUI(searchType, graph, start, end);
				//VisualisationUI.openUI(searchType, graph, start, end);
				frame.setVisible(false);
				System.out.println(start.toString());
				System.out.println(end.toString());
				System.out.println(blockSet.toString());
				System.out.println(block.toString());

			}
			catch(NullPointerException e)
			{
				JOptionPane.showMessageDialog(null, "You should set a start/goal node!");
			}
			
		}
		});
		
		searchTypeComboBox.addItemListener(new ItemListener() 
		{
			public void itemStateChanged(ItemEvent event) 
			{
				if(event.getStateChange()==ItemEvent.SELECTED)
				{
					Object source = event.getSource();
					if(source instanceof JComboBox)
					{
						//Set the search type to what the user has selected
						JComboBox<String> jcb = (JComboBox<String>)source;
						searchType = (String) jcb.getSelectedItem();
					}
				}
			}
		});
	}

	/*
	 * This method is used to clear all the parameters so that it starts clean.
	 */
	public static void refresh() {
		chosenX = 0;
		chosenY = 0;
		block.clear();
		blockSet.clear();
		obstacles.clear();
		
	}
	
	/**
	 * Same code used for all buttons on page
	 * Sets colour and changes colour on mouse action 	
	 * @param button - JButton from page
	 */
	public static void ChangeButtonColour(JButton button){
		
		button.setBackground(Color.DARK_GRAY);
		button.setForeground(new Color(210, 105, 30));
		
		button.addMouseListener(new MouseAdapter()
		{
			 public void mouseEntered(MouseEvent evt)
	            {
	        		button.setBorder(BorderFactory.createLineBorder(Color.DARK_GRAY));
	        		button.setBackground(new Color(210, 105, 30));
	        		button.setForeground(Color.DARK_GRAY);
	            }
	            public void mouseExited(MouseEvent evt)
	            {
	        		button.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
	        		button.setBackground(Color.DARK_GRAY);
	        		button.setForeground(new Color(210, 105, 30));
	            }
	            public void mousePressed(MouseEvent evt)
	            {
	        		button.setBorder(BorderFactory.createLineBorder(Color.DARK_GRAY));
	            }
	            public void mouseReleased(MouseEvent evt)
	            {
	        		button.setBorder(BorderFactory.createLineBorder(Color.DARK_GRAY));
	            }
		});
	}
}
